<!-- HTML generated using hilite.me --><div style="background: #f0f0f0; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">dat &lt;- as.matrix(read.table(&quot;../data/dat.txt&quot;))</span>

<span style="color: #888888">y &lt;- dat[,1]</span>
<span style="color: #888888">X &lt;- dat[,-1]</span>
<span style="color: #888888">k &lt;- ncol(X)</span>
<span style="color: #888888">n &lt;- length(y)</span>
<span style="color: #888888">colnames(X) &lt;- paste0(&quot;b&quot;,0:9)</span>
<span style="color: #888888">Xt &lt;- t(X)</span>
<span style="color: #888888">XXi &lt;- solve(Xt%*%X)</span>
<span style="color: #888888">s &lt;- 100</span>
<span style="color: #888888">XXi%*%Xt%*%y</span>
<span style="color: #888888">a &lt;- 1</span>
<span style="color: #888888">b &lt;- 1</span>
<span style="color: #888888">B &lt;- 1e5</span>
<span style="color: #888888">s2 &lt;- 10</span>

<span style="color: #888888">det &lt;- function(x,log=F) as.numeric(determinant(x,log=log))[1]</span>
<span style="color: #888888">ll &lt;- function(be,sig2) t(y-X%*%be)%*%(y-X%*%be)/(-2*sig2) - n/2*log(sig2)</span>
<span style="color: #888888">lpb &lt;- function(be) -t(be)%*%XXi%*%be/(s2*2)</span>
<span style="color: #888888">lps &lt;- function(sig2) (a-1)*log(sig2)-sig2/b</span>
<span style="color: #888888">mvrnorm &lt;- function(M,S,n=nrow(S)) M + t(chol(S)) %*% rnorm(n)</span>

<span style="color: #888888">csb &lt;- 4*XXi</span>
<span style="color: #888888">css &lt;- 1</span>
<span style="color: #888888">acc.b &lt;- 0</span>
<span style="color: #888888">acc.s &lt;- 0</span>

<span style="color: #888888">b.hat &lt;- matrix(0,B,k)</span>
<span style="color: #888888">s2.hat &lt;- rep(1,B)</span>

<span style="color: #888888">r.time &lt;- system.time(</span>
<span style="color: #888888">for (i in 2:B) {</span>
<span style="color: #888888">  b.hat[i,] &lt;- b.hat[i-1,]</span>
<span style="color: #888888">  s2.hat[i] &lt;- s2.hat[i-1]</span>

<span style="color: #888888">  # Update Beta</span>
<span style="color: #888888">  cand &lt;- mvrnorm(b.hat[i,],csb)</span>
<span style="color: #888888">  q &lt;- ll(cand,s2.hat[i])+lpb(cand)-ll(b.hat[i,],s2.hat[i])-lpb(b.hat[i,])</span>
<span style="color: #888888">  if (q&gt;log(runif(1))) {</span>
<span style="color: #888888">    b.hat[i,] &lt;- cand</span>
<span style="color: #888888">    acc.b &lt;- acc.b+1</span>
<span style="color: #888888">  }</span>

<span style="color: #888888">  # Update s2</span>
<span style="color: #888888">  cand &lt;- rnorm(1,s2.hat[i],css)</span>
<span style="color: #888888">  if (cand&gt;0) {</span>
<span style="color: #888888">    q &lt;- ll(b.hat[i,],cand)+lps(cand)-ll(b.hat[i,],s2.hat[i])-lps(s2.hat[i])</span>
<span style="color: #888888">    if (q&gt;log(runif(1))) {</span>
<span style="color: #888888">      s2.hat[i] &lt;- cand</span>
<span style="color: #888888">      acc.s &lt;- acc.s+1</span>
<span style="color: #888888">    }</span>
<span style="color: #888888">  }</span>

<span style="color: #888888">  cat(paste0(&quot;\r&quot;,round(100*i/B),&quot;%&quot;))</span>
<span style="color: #888888">}</span>
<span style="color: #888888">)</span>
</pre></td></tr></table></div>
